{"ast":null,"code":"\"use strict\";\n\n// Copyright 2018 Google LLC\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GaxiosError = exports.GAXIOS_ERROR_SYMBOL = void 0;\nexports.defaultErrorRedactor = defaultErrorRedactor;\nconst extend_1 = __importDefault(require(\"extend\"));\nconst util_cjs_1 = __importDefault(require(\"./util.cjs\"));\nconst pkg = util_cjs_1.default.pkg;\n/**\n * Support `instanceof` operator for `GaxiosError`s in different versions of this library.\n *\n * @see {@link GaxiosError[Symbol.hasInstance]}\n */\nexports.GAXIOS_ERROR_SYMBOL = Symbol.for(`${pkg.name}-gaxios-error`);\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\nclass GaxiosError extends Error {\n  config;\n  response;\n  error;\n  /**\n   * An error code.\n   * Can be a system error code, DOMException error name, or any error's 'code' property where it is a `string`.\n   *\n   * @see {@link https://nodejs.org/api/errors.html#errorcode error.code}\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/DOMException#error_names DOMException#error_names}\n   *\n   * @example\n   * 'ECONNRESET'\n   *\n   * @example\n   * 'TimeoutError'\n   */\n  code;\n  /**\n   * An HTTP Status code.\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Response/status Response#status}\n   *\n   * @example\n   * 500\n   */\n  status;\n  /**\n   * Support `instanceof` operator for `GaxiosError` across builds/duplicated files.\n   *\n   * @see {@link GAXIOS_ERROR_SYMBOL}\n   * @see {@link GaxiosError[Symbol.hasInstance]}\n   * @see {@link https://github.com/microsoft/TypeScript/issues/13965#issuecomment-278570200}\n   * @see {@link https://stackoverflow.com/questions/46618852/require-and-instanceof}\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/@@hasInstance#reverting_to_default_instanceof_behavior}\n   */\n  [exports.GAXIOS_ERROR_SYMBOL] = pkg.version;\n  /**\n   * Support `instanceof` operator for `GaxiosError` across builds/duplicated files.\n   *\n   * @see {@link GAXIOS_ERROR_SYMBOL}\n   * @see {@link GaxiosError[GAXIOS_ERROR_SYMBOL]}\n   */\n  static [Symbol.hasInstance](instance) {\n    if (instance && typeof instance === 'object' && exports.GAXIOS_ERROR_SYMBOL in instance && instance[exports.GAXIOS_ERROR_SYMBOL] === pkg.version) {\n      return true;\n    }\n    // fallback to native\n    return Function.prototype[Symbol.hasInstance].call(GaxiosError, instance);\n  }\n  constructor(message, config, response, error) {\n    super(message);\n    this.config = config;\n    this.response = response;\n    this.error = error;\n    // deep-copy config as we do not want to mutate\n    // the existing config for future retries/use\n    this.config = (0, extend_1.default)(true, {}, config);\n    if (this.response) {\n      this.response.config = (0, extend_1.default)(true, {}, this.response.config);\n    }\n    if (this.response) {\n      try {\n        this.response.data = translateData(this.config.responseType,\n        // workaround for `node-fetch`'s `.data` deprecation...\n        this.response?.bodyUsed ? this.response?.data : undefined);\n      } catch {\n        // best effort - don't throw an error within an error\n        // we could set `this.response.config.responseType = 'unknown'`, but\n        // that would mutate future calls with this config object.\n      }\n      this.status = this.response.status;\n    }\n    if (error && 'code' in error && error.code) {\n      this.code = error.code;\n    }\n  }\n}\nexports.GaxiosError = GaxiosError;\nfunction translateData(responseType, data) {\n  switch (responseType) {\n    case 'stream':\n      return data;\n    case 'json':\n      return JSON.parse(JSON.stringify(data));\n    case 'arraybuffer':\n      return JSON.parse(Buffer.from(data).toString('utf8'));\n    case 'blob':\n      return JSON.parse(data.text());\n    default:\n      return data;\n  }\n}\n/**\n * An experimental error redactor.\n *\n * @param config Config to potentially redact properties of\n * @param response Config to potentially redact properties of\n *\n * @experimental\n */\nfunction defaultErrorRedactor(data) {\n  const REDACT = '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.';\n  function redactHeaders(headers) {\n    if (!headers) return;\n    headers.forEach((_, key) => {\n      // any casing of `Authentication`\n      // any casing of `Authorization`\n      // anything containing secret, such as 'client secret'\n      if (/^authentication$/i.test(key) || /^authorization$/i.test(key) || /secret/i.test(key)) headers.set(key, REDACT);\n    });\n  }\n  function redactString(obj, key) {\n    if (typeof obj === 'object' && obj !== null && typeof obj[key] === 'string') {\n      const text = obj[key];\n      if (/grant_type=/i.test(text) || /assertion=/i.test(text) || /secret/i.test(text)) {\n        obj[key] = REDACT;\n      }\n    }\n  }\n  function redactObject(obj) {\n    if (!obj || typeof obj !== 'object') {\n      return;\n    } else if (obj instanceof FormData || obj instanceof URLSearchParams ||\n    // support `node-fetch` FormData/URLSearchParams\n    'forEach' in obj && 'set' in obj) {\n      obj.forEach((_, key) => {\n        if (['grant_type', 'assertion'].includes(key) || /secret/.test(key)) {\n          obj.set(key, REDACT);\n        }\n      });\n    } else {\n      if ('grant_type' in obj) {\n        obj['grant_type'] = REDACT;\n      }\n      if ('assertion' in obj) {\n        obj['assertion'] = REDACT;\n      }\n      if ('client_secret' in obj) {\n        obj['client_secret'] = REDACT;\n      }\n    }\n  }\n  if (data.config) {\n    redactHeaders(data.config.headers);\n    redactString(data.config, 'data');\n    redactObject(data.config.data);\n    redactString(data.config, 'body');\n    redactObject(data.config.body);\n    if (data.config.url.searchParams.has('token')) {\n      data.config.url.searchParams.set('token', REDACT);\n    }\n    if (data.config.url.searchParams.has('client_secret')) {\n      data.config.url.searchParams.set('client_secret', REDACT);\n    }\n  }\n  if (data.response) {\n    defaultErrorRedactor({\n      config: data.response.config\n    });\n    redactHeaders(data.response.headers);\n    // workaround for `node-fetch`'s `.data` deprecation...\n    if (data.response.bodyUsed) {\n      redactString(data.response, 'data');\n      redactObject(data.response.data);\n    }\n  }\n  return data;\n}","map":{"version":3,"names":["exports","defaultErrorRedactor","extend_1","__importDefault","require","util_cjs_1","pkg","default","GAXIOS_ERROR_SYMBOL","Symbol","for","name","GaxiosError","Error","config","response","error","code","status","version","hasInstance","instance","Function","prototype","call","constructor","message","data","translateData","responseType","bodyUsed","undefined","JSON","parse","stringify","Buffer","from","toString","text","REDACT","redactHeaders","headers","forEach","_","key","test","set","redactString","obj","redactObject","FormData","URLSearchParams","includes","body","url","searchParams","has"],"sources":["../../../src/common.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}