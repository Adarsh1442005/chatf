{"ast":null,"code":"\"use strict\";\n\n// Copyright 2021 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fromProto3JSONToInternalRepresentation = fromProto3JSONToInternalRepresentation;\nexports.fromProto3JSON = fromProto3JSON;\nconst any_1 = require(\"./any\");\nconst bytes_1 = require(\"./bytes\");\nconst enum_1 = require(\"./enum\");\nconst value_1 = require(\"./value\");\nconst util_1 = require(\"./util\");\nconst duration_1 = require(\"./duration\");\nconst timestamp_1 = require(\"./timestamp\");\nconst wrappers_1 = require(\"./wrappers\");\nconst fieldmask_1 = require(\"./fieldmask\");\nfunction fromProto3JSONToInternalRepresentation(type, json) {\n  const fullyQualifiedTypeName = typeof type === 'string' ? type : (0, util_1.getFullyQualifiedTypeName)(type);\n  if (typeof type !== 'string' && 'values' in type) {\n    // type is an Enum\n    if (fullyQualifiedTypeName === '.google.protobuf.NullValue') {\n      return 'NULL_VALUE';\n    }\n    return (0, enum_1.resolveEnumValueToString)(type, json);\n  }\n  if (typeof type !== 'string') {\n    type.resolveAll();\n  }\n  if (typeof type === 'string') {\n    return json;\n  }\n  // Types that require special handling according to\n  // https://developers.google.com/protocol-buffers/docs/proto3#json\n  // Types that can have meaningful \"null\" value\n  if (fullyQualifiedTypeName === '.google.protobuf.Value') {\n    return (0, value_1.googleProtobufValueFromProto3JSON)(json);\n  }\n  if (util_1.wrapperTypes.has(fullyQualifiedTypeName)) {\n    if (json !== null && typeof json === 'object' || Array.isArray(json)) {\n      throw new Error(`fromProto3JSONToInternalRepresentation: JSON representation for ${fullyQualifiedTypeName} expects a string, a number, or a boolean, but got ${typeof json}`);\n    }\n    return (0, wrappers_1.wrapperFromProto3JSON)(fullyQualifiedTypeName, json);\n  }\n  if (json === null) {\n    return null;\n  }\n  // Types that cannot be \"null\"\n  if (fullyQualifiedTypeName === '.google.protobuf.Any') {\n    return (0, any_1.googleProtobufAnyFromProto3JSON)(type.root, json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.Struct') {\n    if (typeof json !== 'object') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.Struct must be an object but got ${typeof json}`);\n    }\n    if (Array.isArray(json)) {\n      throw new Error('fromProto3JSONToInternalRepresentation: google.protobuf.Struct must be an object but got an array');\n    }\n    return (0, value_1.googleProtobufStructFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.ListValue') {\n    if (!Array.isArray(json)) {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.ListValue must be an array but got ${typeof json}`);\n    }\n    return (0, value_1.googleProtobufListValueFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.Duration') {\n    if (typeof json !== 'string') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.Duration must be a string but got ${typeof json}`);\n    }\n    return (0, duration_1.googleProtobufDurationFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.Timestamp') {\n    if (typeof json !== 'string') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.Timestamp must be a string but got ${typeof json}`);\n    }\n    return (0, timestamp_1.googleProtobufTimestampFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.FieldMask') {\n    if (typeof json !== 'string') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.FieldMask must be a string but got ${typeof json}`);\n    }\n    return (0, fieldmask_1.googleProtobufFieldMaskFromProto3JSON)(json);\n  }\n  const result = {};\n  for (const [key, value] of Object.entries(json)) {\n    const field = type.fields[key];\n    if (!field) {\n      continue;\n    }\n    const resolvedType = field.resolvedType;\n    const fieldType = field.type;\n    if (field.repeated) {\n      if (value === null) {\n        result[key] = [];\n      } else {\n        if (!Array.isArray(value)) {\n          throw new Error(`fromProto3JSONToInternalRepresentation: expected an array for field ${key}`);\n        }\n        result[key] = value.map(element => fromProto3JSONToInternalRepresentation(resolvedType || fieldType, element));\n      }\n    } else if (field.map) {\n      const map = {};\n      for (const [mapKey, mapValue] of Object.entries(value)) {\n        map[mapKey] = fromProto3JSONToInternalRepresentation(resolvedType || fieldType, mapValue);\n      }\n      result[key] = map;\n    } else if (fieldType.match(/^(?:(?:(?:u?int|fixed)(?:32|64))|float|double)$/)) {\n      if (typeof value !== 'number' && typeof value !== 'string') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = value;\n    } else if (fieldType === 'string') {\n      if (typeof value !== 'string') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = value;\n    } else if (fieldType === 'bool') {\n      if (typeof value !== 'boolean') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = value;\n    } else if (fieldType === 'bytes') {\n      if (typeof value !== 'string') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = (0, bytes_1.bytesFromProto3JSON)(value);\n    } else {\n      // Message type\n      (0, util_1.assert)(resolvedType !== null, `Expected to be able to resolve type for field ${field.name}`);\n      const deserializedValue = fromProto3JSONToInternalRepresentation(resolvedType, value);\n      result[key] = deserializedValue;\n    }\n  }\n  return result;\n}\nfunction fromProto3JSON(type, json) {\n  const internalRepr = fromProto3JSONToInternalRepresentation(type, json);\n  if (internalRepr === null) {\n    return null;\n  }\n  // We only expect a real object here sine all special cases should be already resolved. Everything else is an internal error\n  (0, util_1.assert)(typeof internalRepr === 'object' && !Array.isArray(internalRepr), `fromProto3JSON: expected an object, not ${json}`);\n  return type.fromObject(internalRepr);\n}","map":{"version":3,"names":["exports","fromProto3JSONToInternalRepresentation","fromProto3JSON","any_1","require","bytes_1","enum_1","value_1","util_1","duration_1","timestamp_1","wrappers_1","fieldmask_1","type","json","fullyQualifiedTypeName","getFullyQualifiedTypeName","resolveEnumValueToString","resolveAll","googleProtobufValueFromProto3JSON","wrapperTypes","has","Array","isArray","Error","wrapperFromProto3JSON","googleProtobufAnyFromProto3JSON","root","googleProtobufStructFromProto3JSON","googleProtobufListValueFromProto3JSON","googleProtobufDurationFromProto3JSON","googleProtobufTimestampFromProto3JSON","googleProtobufFieldMaskFromProto3JSON","result","key","value","Object","entries","field","fields","resolvedType","fieldType","repeated","map","element","mapKey","mapValue","match","bytesFromProto3JSON","assert","name","deserializedValue","internalRepr","fromObject"],"sources":["../../typescript/src/fromproto3json.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}